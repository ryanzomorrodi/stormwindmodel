<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Modeling storm winds outside the United States • stormwindmodel</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Modeling storm winds outside the United States">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">stormwindmodel</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.5.11</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Details.html">Details of `stormwindmodel` package</a></li>
    <li><a class="dropdown-item" href="../articles/modeling_outside_us.html">Modeling storm winds outside the United States</a></li>
    <li><a class="dropdown-item" href="../articles/Overview.html">Using the `stormwindmodel` package</a></li>
    <li><a class="dropdown-item" href="../articles/single_location.html">Modeling windspeed and direction at a single location</a></li>
    <li><a class="dropdown-item" href="../articles/timepoints.html">Extracting snapshots of the wind field at different times</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/geanders/stormwindmodel/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Modeling storm winds outside the United States</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/geanders/stormwindmodel/blob/master/vignettes/modeling_outside_us.Rmd" class="external-link"><code>vignettes/modeling_outside_us.Rmd</code></a></small>
      <div class="d-none name"><code>modeling_outside_us.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/geanders/stormwindmodel" class="external-link">stormwindmodel</a></span><span class="op">)</span></span></code></pre></div>
<p>In the main vignettes for this package, we focused on modeling wind
speeds within counties in the Eastern half of the United States.
However, you can also use the wind model to model in other parts of the
world, or to model at different locations (rather than county centers)
in the United States. This vignette walks through some examples of how
you can use the package to model windspeeds any where.</p>
<div class="section level2">
<h2 id="creating-a-dataframe-with-grid-points">Creating a dataframe with grid points<a class="anchor" aria-label="anchor" href="#creating-a-dataframe-with-grid-points"></a>
</h2>
<p>You may have a dataframe with the latitude and longitude of the
points you want to model for a storm. For example, you may have a
dataset with the location of cities where you want to model winds, or
you may have a shapefile with the spatial information of another
geography in your area of interest, which can be used as a starting
point to determine centroids, which you can then model. However, if you
do not have a starting dataset with locations to model, you can still
use this package. In this case, you’ll want to start by creating a grid
of points at latitudes and longitudes that are evenly spaced across your
area of interest. This section of this vignette will walk through how
you can do that (if you already have your dataset of points to model to,
you can skip this section).</p>
<p>If you don’t have a geographic dataset with locations to model winds,
you can create a gridded geographic dataset of the region of interest.
The <code>sf</code> package has a function that can take an existing
geographic R object and create a regularly-spaced grid over the area of
that object. You can use this to create your grid.</p>
<p>First, to get the starting geographic R object, you can use the
<code>rnaturalearth</code> package, which provides spatial data for
countries and subcountry geographies around the world. You can use this
to get the borders of countries worldwide, then crop this object to the
latitude and longitude ranges that you are interested in. For example,
the following code creates a cropped geographical R object for the
region from 107 to 128 degrees longitude and 17.5 to 34 degrees
latitude, focusing on an area affected by Typhoon Saomai in 2006:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rnaturalearth/" class="external-link">rnaturalearth</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">all_countries</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html" class="external-link">ne_countries</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="st">"medium"</span>, </span>
<span>                                  returnclass <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span></span>
<span><span class="va">near_landfall</span> <span class="op">&lt;-</span> <span class="va">all_countries</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html" class="external-link">st_make_valid</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html" class="external-link">st_crop</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="fl">107</span>, xmax <span class="op">=</span> <span class="fl">128</span>, ymin <span class="op">=</span> <span class="fl">17.5</span>, ymax <span class="op">=</span> <span class="fl">34</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">near_landfall</span><span class="op">)</span> </span></code></pre></div>
<p><img src="modeling_outside_us_files/figure-html/unnamed-chunk-2-1.png"><!-- --></p>
<p>Next, you can use the <code>st_make_grid</code> function from the
<code>sf</code> package to create new objects with a regular grid over
this area. You can use this function to create two types of grids:
centers—which will provide the point locations (latitude and longitude)
at the center of each grid—or polygons—which will create geographic
polygon shapes that cover the full grid. You will need the point
locations to input to the model, but you may also want to create a
polygon version to use to map the output later. Just make sure that, if
you create both types of objects, you use the same resolution for each
(<code>cellsize</code>) and you create a grid ID that aligns between the
two datasets (which we do here with
<code>gridid = as.character(1:n())</code>) so you can connect the
modeled winds back to the polygon geographic data. Here is the code to
create both types of objects (you can choose to have the grid shapes
either be squares (<code>square = TRUE</code>) or hexagons
(<code>square = FALSE</code>). We’ve used hexagons). The code creates a
map showing both these layers, with transparency for the fill in the
polygons (<code>alpha = 0.4</code>) so you can see all layers:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">grid_near_landfall</span> <span class="op">&lt;-</span> <span class="va">near_landfall</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html" class="external-link">st_make_grid</a></span><span class="op">(</span>what <span class="op">=</span> <span class="st">"polygons"</span>, square <span class="op">=</span> <span class="cn">FALSE</span>, cellsize <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>gridid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">points_near_landfall</span> <span class="op">&lt;-</span> <span class="va">near_landfall</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html" class="external-link">st_make_grid</a></span><span class="op">(</span>what <span class="op">=</span> <span class="st">"centers"</span>, square <span class="op">=</span> <span class="cn">FALSE</span>, cellsize <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>gridid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">near_landfall</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">grid_near_landfall</span>, color <span class="op">=</span> <span class="st">"red"</span>, fill <span class="op">=</span> <span class="cn">NA</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">points_near_landfall</span>, color <span class="op">=</span> <span class="st">"blue"</span>, fill <span class="op">=</span> <span class="cn">NA</span>, alpha <span class="op">=</span> <span class="fl">0.2</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="modeling_outside_us_files/figure-html/unnamed-chunk-3-1.png"><!-- --></p>
<p>Next, you can use the point location geographic object to create a
regular dataframe that you can input to the wind model. This process
includes extracting the geometry information (latitude and longitude)
into separate columns, which you can do using the
<code>st_coordinates</code> function from the <code>sf</code> package
and then “dropping” the geographic information from the object using
<code>st_drop_geometry</code> (this will change the object to a regular
dataframe, rather than a spatial one). It also involves using the
land/sea mask from the package to determine which points are over land
and which are over water, which you can do using the
<code>check_land_function</code> from the <code>stormwindmodel</code>
package. You can convert this to a format that’s ready to enter in the
storm wind modeling function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">points_to_model</span> <span class="op">&lt;-</span> <span class="va">points_near_landfall</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>glon <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>         glat <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>gridid <span class="op">=</span> <span class="va">gridid</span>, </span>
<span>         glandsea <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="va">check_over_land</span>, tclat <span class="op">=</span> <span class="va">.</span><span class="op">$</span><span class="va">glat</span>, tclon <span class="op">=</span> <span class="va">.</span><span class="op">$</span><span class="va">glon</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">points_to_model</span><span class="op">)</span></span>
<span><span class="co">#&gt;   gridid    glon     glat glandsea</span></span>
<span><span class="co">#&gt; 1      1 106.875 17.94102    FALSE</span></span>
<span><span class="co">#&gt; 2      2 106.875 18.37404    FALSE</span></span>
<span><span class="co">#&gt; 3      3 106.875 18.80705    FALSE</span></span>
<span><span class="co">#&gt; 4      4 106.875 19.24006    FALSE</span></span>
<span><span class="co">#&gt; 5      5 106.875 19.67308    FALSE</span></span>
<span><span class="co">#&gt; 6      6 106.875 20.10609    FALSE</span></span></code></pre></div>
<p>You can re-join this dataframe with the spatial version and plot it
to check that the land/sea mask did a reasonable job of capturing grid
points that are over land versus over water:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">points_near_landfall</span> <span class="op">&lt;-</span> <span class="va">points_near_landfall</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">points_to_model</span>, by <span class="op">=</span> <span class="st">"gridid"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">all_countries</span>, fill <span class="op">=</span> <span class="st">"tan"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">points_near_landfall</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">glandsea</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.8</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lightblue"</span>, <span class="st">"darkgreen"</span><span class="op">)</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">107</span>, <span class="fl">128</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">17.5</span>, <span class="fl">34</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="modeling_outside_us_files/figure-html/unnamed-chunk-5-1.png"><!-- --></p>
<p>If you would like a better resolution of land / sea than is provided
by this landmask, you can use your own landmask dataset, with a high
resolution focused on your area of interest, to create the
<code>glandsea</code> column that you need in the grid points dataset.
Alternatively, if you are only modeling locaitons that are over land
(e.g., only modeling at city centers), you could set this column to
always have the value <code>TRUE</code>.</p>
</div>
<div class="section level2">
<h2 id="preparing-storm-tracks-data-for-wind-model-function">Preparing storm tracks data for wind model function<a class="anchor" aria-label="anchor" href="#preparing-storm-tracks-data-for-wind-model-function"></a>
</h2>
<p>The next step is to collect data on the central track and wind speeds
of the storm that you would like to model. This data is available for
storms worldwide from IBTrACS, so we are using that source as an example
here. You will need to reformat the data some to prepare it to serve as
input to the wind modeling functions in this package.</p>
<p>There is an example dataset in the <code>stormwindmodel</code>
package that includes a storm, Typhoon Saomai, that affected the area
that we developed an example grid for in the last section. The dataset
is included in the format it would be in if you read in directly from a
CSV file from IBTrACS—the only changes are that (1) only a few of the
columns have been selected, rather than all the columns that are
available in the IBTrACS data, and (2) the column names have been
changed from all uppercase to all lowercase.</p>
<p>Before you can input this to the wind model code, you’ll need to make
a few changes to the dataset. First, the date is in a date-time format,
and you’ll need to change it to a character in the form of, for example,
“200608040300” for August 4, 2006 at 3 AM Greenwich Mean Time (UTM). You
should name this column “date”. Next, you’ll need to convert the columns
with latitude and longitude to numeric data types and change these
column names from “lat” to “latitude” and from “lon” to “longitude” (one
way you can do this is using <code>transmute</code>, which will only
keep the new columns). Finally, you need to convert the column with wind
data (in US conventions of [wind averaging period and height]) to a
numeric data type and rename the column from “usa_wind” to “wind”. You
can do all these steps with the following code:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"saomai_tracks"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">saomai_to_model</span> <span class="op">&lt;-</span> <span class="va">saomai_tracks</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">iso_time</span>, format <span class="op">=</span> <span class="st">"%Y%m%d%H%M"</span><span class="op">)</span>, </span>
<span>            latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">lat</span><span class="op">)</span>, </span>
<span>            longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">lon</span><span class="op">)</span>,</span>
<span>            wind <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">usa_wind</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now you have converted all the required data into the format that is
needed to run the storm wind code. If you are interested in getting just
the maximum wind speeds at each grid point (that is, the maximum wind at
that point over the full course of the storm), you can use the
<code>get_grid_winds</code> function to do that. First, you’ll run the
function using the dataset of grid points that you created as the
<code>grid_df</code> input and the track data for Typhoon Saomai as the
<code>hurr_track</code> input:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid_winds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_grid_winds.html">get_grid_winds</a></span><span class="op">(</span>hurr_track <span class="op">=</span> <span class="va">saomai_to_model</span>,</span>
<span>                             grid_df <span class="op">=</span> <span class="va">points_to_model</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">grid_winds</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;   gridid date_time_max_wind vmax_sust vmax_gust sust_dur gust_dur</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1      <span style="color: #BB0000;">NA</span>                     0.240     0.357        0        0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2      <span style="color: #BB0000;">NA</span>                     0.272     0.405        0        0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 3      <span style="color: #BB0000;">NA</span>                     0.309     0.460        0        0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 4      <span style="color: #BB0000;">NA</span>                     0.350     0.521        0        0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 5      <span style="color: #BB0000;">NA</span>                     0.396     0.590        0        0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 6      <span style="color: #BB0000;">NA</span>                     0.447     0.667        0        0</span></span></code></pre></div>
<p>The output will have a row for every grid point, where the grid point
IDs match those from the grid point dataset you created (you can use
this ID to link the data back to the spatial data object, for example,
so you can plot the winds). For each grid point, it gives the maximum
surface-level sustained windspeed over the course of the storm
(<code>vmax_sust</code>), the maximum gust (<code>vmax_gust</code>—note
that this is obtained as a simple multiplicative factor of
<code>vmax_sust</code>), the duration of sustained and gust winds over
20 m/s (<code>sust_dur</code> and <code>gust_dur</code>, respectively;
note that if you want to change the threshold from 20 m/s to another
value, you can do so with the <code>sust_duration_cut</code> and
<code>gust_duration_cut</code> parameters in
<code>get_grid_winds</code>), and the date and time (given based on the
Greenwich Mean Time [UTM] time zone) when the wind was at its maximum at
that grid point (typically, this will be around the time the storm was
closest to the grid point, but there may be some cases where it’s not
the closest time point—for example, since the storm’s wind often decays
rapidly after landfall, a local wind may be highest while the storm is
still over water, even if the storm later passes closer to the
location).</p>
<p>To plot these data, you can join them back with the spatial gridded
dataframe, using the grid ID to match between the two datasets. This
gets the data back into an <code>sf</code> object type, which makes it
easy to map:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">modeled_near_landfall</span> <span class="op">&lt;-</span> <span class="va">grid_near_landfall</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">grid_winds</span>, by <span class="op">=</span> <span class="st">"gridid"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">modeled_near_landfall</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 6 fields</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 106.75 ymin: 17.79669 xmax: 107 ymax: 20.25043</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt;   gridid date_time_max_wind vmax_sust vmax_gust sust_dur gust_dur</span></span>
<span><span class="co">#&gt; 1      1               &lt;NA&gt; 0.2395313 0.3569016        0        0</span></span>
<span><span class="co">#&gt; 2      2               &lt;NA&gt; 0.2719318 0.4051784        0        0</span></span>
<span><span class="co">#&gt; 3      3               &lt;NA&gt; 0.3085442 0.4597309        0        0</span></span>
<span><span class="co">#&gt; 4      4               &lt;NA&gt; 0.3497092 0.5210667        0        0</span></span>
<span><span class="co">#&gt; 5      5               &lt;NA&gt; 0.3958561 0.5898256        0        0</span></span>
<span><span class="co">#&gt; 6      6               &lt;NA&gt; 0.4474243 0.6666621        0        0</span></span>
<span><span class="co">#&gt;                         geometry</span></span>
<span><span class="co">#&gt; 1 POLYGON ((106.875 17.79669,...</span></span>
<span><span class="co">#&gt; 2 POLYGON ((106.875 18.2297, ...</span></span>
<span><span class="co">#&gt; 3 POLYGON ((106.875 18.66271,...</span></span>
<span><span class="co">#&gt; 4 POLYGON ((106.875 19.09572,...</span></span>
<span><span class="co">#&gt; 5 POLYGON ((106.875 19.52874,...</span></span>
<span><span class="co">#&gt; 6 POLYGON ((106.875 19.96175,...</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">modeled_near_landfall</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">vmax_sust</span>, fill <span class="op">=</span> <span class="va">vmax_sust</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">all_countries</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_color_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span> <span class="op">+</span>   </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">107</span>, <span class="fl">128</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">17.5</span>, <span class="fl">34</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="modeling_outside_us_files/figure-html/unnamed-chunk-9-1.png"><!-- --></p>
<p>You can zoom this map in by changing the ranges on the
<code>coord_sf</code> layer, for example:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">modeled_near_landfall</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">vmax_sust</span>, fill <span class="op">=</span> <span class="va">vmax_sust</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">all_countries</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_color_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span> <span class="op">+</span>   </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">116</span>, <span class="fl">123</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="modeling_outside_us_files/figure-html/unnamed-chunk-10-1.png"><!-- --></p>
<p>You likely will also want to add the storm track. You have all the
information you need to do that, since you have latitude and longitude
of the storm track in the <code>saomai_to_model</code> object. However,
to add it to the map, you’ll need to convert it to an sf object class by
specifying which columns provide this information as well as giving an
appropriate coordinate reference system number, so that it can be
projected correctly.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">saomai_sf_points</span> <span class="op">&lt;-</span> <span class="va">saomai_to_model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">modeled_near_landfall</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">saomai_sf_line</span> <span class="op">&lt;-</span> <span class="va">saomai_sf_points</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>do_union <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span><span class="st">"LINESTRING"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">modeled_near_landfall</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">vmax_sust</span>, fill <span class="op">=</span> <span class="va">vmax_sust</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">all_countries</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">saomai_sf_line</span>, color <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">saomai_sf_points</span>, color <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_color_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span> <span class="op">+</span>   </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">107</span>, <span class="fl">128</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">17.5</span>, <span class="fl">34</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="modeling_outside_us_files/figure-html/unnamed-chunk-11-1.png"><!-- --></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">modeled_near_landfall</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">vmax_sust</span>, fill <span class="op">=</span> <span class="va">vmax_sust</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">all_countries</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">saomai_sf_line</span>, color <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">saomai_sf_points</span>, color <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_color_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span> <span class="op">+</span>   </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">116</span>, <span class="fl">123</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="modeling_outside_us_files/figure-html/unnamed-chunk-11-2.png"><!-- --></p>
</div>
<div class="section level2">
<h2 id="another-example-from-start-to-finish">Another example, from start to finish<a class="anchor" aria-label="anchor" href="#another-example-from-start-to-finish"></a>
</h2>
<p>Here is an example of the entire process for a second storm, Typhoon
Mangkhut in 2018. Again, there is an example dataset that comes with the
<code>stormwindmodel</code> package with this storm’s tracks. For other
storms, you would instead start form data downloaded from IBTrACS (for
example, one of their CSV-format datasets). The gridded dataset is
cropped in this case to focus on the area near the storm’s landfall near
Macau, Hong Kong, and Guangzhou. Since this area is geographically more
focused, in this example we use a smaller size for spacing between grid
points.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"mangkhut_tracks"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">all_countries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html" class="external-link">ne_countries</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="st">"medium"</span><span class="op">)</span></span>
<span><span class="va">near_landfall</span> <span class="op">&lt;-</span> <span class="va">all_countries</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html" class="external-link">st_make_valid</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html" class="external-link">st_crop</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="fl">110</span>, xmax <span class="op">=</span> <span class="fl">117</span>, ymin <span class="op">=</span> <span class="fl">19</span>, ymax <span class="op">=</span> <span class="fl">25</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">grid_near_landfall</span> <span class="op">&lt;-</span> <span class="va">near_landfall</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html" class="external-link">st_make_grid</a></span><span class="op">(</span>what <span class="op">=</span> <span class="st">"polygons"</span>, square <span class="op">=</span> <span class="cn">FALSE</span>, cellsize <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>gridid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">points_near_landfall</span> <span class="op">&lt;-</span> <span class="va">near_landfall</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html" class="external-link">st_make_grid</a></span><span class="op">(</span>what <span class="op">=</span> <span class="st">"centers"</span>, square <span class="op">=</span> <span class="cn">FALSE</span>, cellsize <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>gridid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">points_to_model</span> <span class="op">&lt;-</span> <span class="va">points_near_landfall</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>glon <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>         glat <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>gridid <span class="op">=</span> <span class="va">gridid</span>, </span>
<span>         glandsea <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="va">check_over_land</span>, tclat <span class="op">=</span> <span class="va">.</span><span class="op">$</span><span class="va">glat</span>, tclon <span class="op">=</span> <span class="va">.</span><span class="op">$</span><span class="va">glon</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">points_near_landfall</span> <span class="op">&lt;-</span> <span class="va">points_near_landfall</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">points_to_model</span>, by <span class="op">=</span> <span class="st">"gridid"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">near_landfall</span>, fill <span class="op">=</span> <span class="st">"tan"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">points_near_landfall</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">glandsea</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.8</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lightblue"</span>, <span class="st">"darkgreen"</span><span class="op">)</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">110</span>, <span class="fl">117</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="modeling_outside_us_files/figure-html/unnamed-chunk-12-1.png"><!-- --></p>
<p>In this case, you can see that there are a few areas where the
land-sea mask has assigned grid points incorrectly near coastlines. This
is likely because of the resolution of the land-sea mask available in
the <code>stormwindmodel</code> package, which is constrained to be a
reasonable size to fit in a package. If you would like a finer
resolution when determining whether a point is over land or sea, you can
determine this for grid points using your own land-sea mask, at a higher
resolution for the area you’re modeling. Conversely, if you are only
modeling locations that are over land (for example, for a study of human
impacts from a storm), then you can assign all grid points to “TRUE” for
the <code>glandsea</code> column.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"mangkhut_tracks"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mangkhut_to_model</span> <span class="op">&lt;-</span> <span class="va">mangkhut_tracks</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">iso_time</span>, format <span class="op">=</span> <span class="st">"%Y%m%d%H%M"</span><span class="op">)</span>, </span>
<span>            latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">lat</span><span class="op">)</span>, </span>
<span>            longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">lon</span><span class="op">)</span>,</span>
<span>            wind <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">usa_wind</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">grid_winds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_grid_winds.html">get_grid_winds</a></span><span class="op">(</span>hurr_track <span class="op">=</span> <span class="va">mangkhut_to_model</span>,</span>
<span>                             grid_df <span class="op">=</span> <span class="va">points_to_model</span><span class="op">)</span></span>
<span></span>
<span><span class="va">modeled_near_landfall</span> <span class="op">&lt;-</span> <span class="va">grid_near_landfall</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">grid_winds</span>, by <span class="op">=</span> <span class="st">"gridid"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mangkhut_sf_points</span> <span class="op">&lt;-</span> <span class="va">mangkhut_to_model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">modeled_near_landfall</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">mangkhut_sf_line</span> <span class="op">&lt;-</span> <span class="va">mangkhut_sf_points</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>do_union <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span><span class="st">"LINESTRING"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">modeled_near_landfall</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">vmax_sust</span>, fill <span class="op">=</span> <span class="va">vmax_sust</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">all_countries</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mangkhut_sf_line</span>, color <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mangkhut_sf_points</span>, color <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_color_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span> <span class="op">+</span>   </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">110</span>, <span class="fl">117</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="modeling_outside_us_files/figure-html/unnamed-chunk-13-1.png"><!-- --></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ryan Zomorrodi, Brooke Anderson, Andrea Schumacher, Seth Guikema, Steven Quiring, Joshua Ferreri, Elizabeth Tennant, Jordan Robinson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
